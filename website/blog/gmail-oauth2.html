<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adding Gmail OAuth2: One Flow, Two Providers - MailVault Blog</title>
  <meta name="description" content="How we added Gmail OAuth2 to MailVault by making the existing Microsoft OAuth2 flow provider-agnostic.">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://mailvaultapp.com/blog/gmail-oauth2.html">
  <meta name="theme-color" content="#6366f1">

  <!-- Open Graph -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://mailvaultapp.com/blog/gmail-oauth2.html">
  <meta property="og:title" content="Adding Gmail OAuth2: One Flow, Two Providers - MailVault Blog">
  <meta property="og:description" content="How we added Gmail OAuth2 to MailVault by making the existing Microsoft OAuth2 flow provider-agnostic.">
  <meta property="og:image" content="https://mailvaultapp.com/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="MailVault">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Adding Gmail OAuth2: One Flow, Two Providers - MailVault Blog">
  <meta name="twitter:description" content="How we added Gmail OAuth2 to MailVault by making the existing Microsoft OAuth2 flow provider-agnostic.">
  <meta name="twitter:image" content="https://mailvaultapp.com/og-image.png">
  <meta name="twitter:site" content="@GraphicMeat">

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc',
              400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca',
              800: '#3730a3', 900: '#312e81',
            }
          }
        }
      }
    }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', system-ui, sans-serif; }
    .gradient-text {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .gradient-bg { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); }
    .glass {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .dark .glass {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    article pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 1rem 1.25rem;
      border-radius: 0.75rem;
      overflow-x: auto;
      font-size: 0.875rem;
      line-height: 1.7;
    }
    .dark article pre {
      background: #0f172a;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    article code:not(pre code) {
      background: rgba(99, 102, 241, 0.1);
      color: #6366f1;
      padding: 0.15rem 0.4rem;
      border-radius: 0.25rem;
      font-size: 0.875em;
    }
    .dark article code:not(pre code) {
      background: rgba(99, 102, 241, 0.2);
      color: #a5b4fc;
    }
  </style>
</head>

<body class="bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 transition-colors duration-300">

  <!-- Navigation -->
  <nav role="banner" class="fixed top-0 left-0 right-0 z-50 glass">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <a href="/" class="flex items-center gap-3">
          <img src="/icon-128.png" alt="MailVault logo" class="w-8 h-8 rounded-lg">
          <span class="font-bold text-xl">Mail<span class="text-primary-500">Vault</span></span>
        </a>

        <div class="hidden md:flex items-center gap-8">
          <a href="/#features" class="text-slate-600 dark:text-slate-300 hover:text-primary-500 transition-colors">Features</a>
          <a href="/#how-it-works" class="text-slate-600 dark:text-slate-300 hover:text-primary-500 transition-colors">How It Works</a>
          <a href="/faq.html" class="text-slate-600 dark:text-slate-300 hover:text-primary-500 transition-colors">FAQ</a>
          <a href="/changelog.html" class="text-slate-600 dark:text-slate-300 hover:text-primary-500 transition-colors">Changelog</a>
          <a href="/blog.html" class="text-primary-500 font-medium">Blog</a>
          <a href="/#contact" class="text-slate-600 dark:text-slate-300 hover:text-primary-500 transition-colors">Contact</a>
        </div>

        <div class="flex items-center gap-4">
          <button id="theme-toggle" class="p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors" title="Toggle theme">
            <svg id="sun-icon" class="w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
            <svg id="moon-icon" class="w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
          </button>
          <a href="https://github.com/GraphicMeat/mail-vault-app/releases/latest" target="_blank" class="hidden sm:inline-flex gradient-bg text-white px-4 py-2 rounded-lg font-medium hover:opacity-90 transition-opacity">
            Download
          </a>
          <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path id="menu-icon-open" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
              <path id="menu-icon-close" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      </div>

      <div id="mobile-menu" class="hidden md:hidden pb-4">
        <div class="flex flex-col gap-2 pt-2 border-t border-slate-200 dark:border-slate-700">
          <a href="/" class="px-3 py-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-primary-500 transition-colors">Home</a>
          <a href="/#features" class="px-3 py-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-primary-500 transition-colors">Features</a>
          <a href="/#how-it-works" class="px-3 py-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-primary-500 transition-colors">How It Works</a>
          <a href="/faq.html" class="px-3 py-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-primary-500 transition-colors">FAQ</a>
          <a href="/changelog.html" class="px-3 py-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-primary-500 transition-colors">Changelog</a>
          <a href="/blog.html" class="px-3 py-2 rounded-lg text-primary-500 font-medium">Blog</a>
          <a href="/#contact" class="px-3 py-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-primary-500 transition-colors">Contact</a>
          <a href="https://github.com/GraphicMeat/mail-vault-app/releases/latest" target="_blank" class="sm:hidden mt-1 px-3 py-2 rounded-lg gradient-bg text-white font-medium text-center hover:opacity-90 transition-opacity">Download</a>
        </div>
      </div>
    </div>
  </nav>

  <main class="pt-24 pb-20">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">

      <a href="/blog.html" class="inline-flex items-center gap-1 text-sm text-primary-500 hover:text-primary-600 transition-colors mb-8">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
        Back to Blog
      </a>

      <article>
        <header class="mb-8">
          <time datetime="2026-02-20" class="text-sm text-primary-500 font-medium">February 20, 2026</time>
          <h1 class="text-3xl sm:text-4xl font-bold mt-2 mb-3">Adding Gmail OAuth2: One Flow, Two Providers</h1>
          <div class="flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400">
            <span>4 min read</span>
          </div>
        </header>

        <div class="prose prose-slate dark:prose-invert max-w-none space-y-5 text-slate-700 dark:text-slate-300 leading-relaxed">

          <p>
            When we shipped Microsoft OAuth2 in v1.2.0, the goal was clear: let users sign in with their existing Microsoft account instead of generating an app password. It worked well for Outlook, Hotmail, and M365 accounts. The natural next step was Gmail &mdash; the most popular email provider in the world.
          </p>

          <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-100 pt-2">Why OAuth2 Matters</h3>

          <p>
            Google has been tightening access to IMAP for years. If you have 2FA enabled (and you should), you need an <a href="https://support.google.com/accounts/answer/185833" class="text-primary-500 hover:text-primary-600 underline">App Password</a> to use third-party email clients. App passwords work, but they're obscure, easy to forget, and feel like a workaround. OAuth2 lets users click "Sign in with Google," authenticate in their browser, and come back to the app &mdash; no passwords copied, no settings pages searched.
          </p>

          <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-100 pt-2">The Implementation</h3>

          <p>
            MailVault already had a working OAuth2 PKCE flow for Microsoft, written in Rust. The architecture has three parts: a local TCP callback server on <code>localhost:19876</code> that receives the redirect after browser login, a token exchange function that swaps the authorization code for access/refresh tokens, and XOAUTH2 SASL authentication for IMAP and SMTP.
          </p>

          <p>
            Adding Google meant making all of this provider-agnostic. Instead of hardcoding Microsoft's endpoints, we refactored the Rust OAuth2 module to accept provider configuration at runtime &mdash; authorization URL, token URL, scopes, and client ID all come from the frontend when initiating the flow.
          </p>

          <p>
            For the client ID, we followed the same approach as Microsoft: use a well-known public client ID. Thunderbird, the open-source email client by Mozilla, registers public OAuth2 clients with both Google and Microsoft. MailVault uses Thunderbird's Google client ID (<code>406964657835-aq8lmia8j95dhl1a2bvharmfk3t1hgqj.apps.googleusercontent.com</code>) with the <code>https://mail.google.com/</code> scope, which grants full IMAP and SMTP access.
          </p>

          <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-100 pt-2">What Changed in the Code</h3>

          <p>
            The Rust side needed a new <code>oauth2_start</code> command that accepts provider-specific parameters (auth URL, token URL, scopes, client ID) instead of assuming Microsoft. The callback server and PKCE logic stayed the same &mdash; OAuth2 is OAuth2, regardless of provider.
          </p>

          <p>
            On the frontend, the <code>AccountModal</code> component now shows a "Sign in with Google" button for Gmail accounts (alongside the existing "Use App Password instead" fallback). The button triggers the same OAuth2 flow, just with Google's endpoints and scopes instead of Microsoft's. After authentication, the access token is used with XOAUTH2 SASL for both IMAP (<code>imap.gmail.com</code>) and SMTP (<code>smtp.gmail.com</code>).
          </p>

          <p>
            Token refresh works identically to Microsoft: when an access token expires (typically after one hour), MailVault automatically refreshes it using the stored refresh token. The user never has to re-authenticate unless they revoke access from their Google account settings.
          </p>

          <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-100 pt-2">The Result</h3>

          <p>
            Gmail users can now click one button, sign in through Google's standard login page, and start using MailVault immediately. No app passwords, no IMAP settings to find, no "less secure apps" toggles. It works with 2FA, Google Workspace, and personal Gmail accounts.
          </p>

          <p>
            The same OAuth2 infrastructure is now ready for any future provider that supports standard OAuth2 &mdash; the Rust module is fully provider-agnostic.
          </p>

        </div>
      </article>

    </div>
  </main>

  <!-- Footer -->
  <footer class="border-t border-slate-200 dark:border-slate-800 py-8">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex items-center gap-2">
          <img src="/icon-128.png" alt="MailVault logo" class="w-8 h-8 rounded-lg">
          <span class="font-bold text-lg">Mail<span class="text-primary-500">Vault</span></span>
        </div>

        <div class="flex items-center gap-6 text-sm text-slate-600 dark:text-slate-400">
          <a href="/privacy.html" class="hover:text-primary-500 transition-colors">Privacy Policy</a>
          <a href="/faq.html" class="hover:text-primary-500 transition-colors">FAQ</a>
          <a href="/changelog.html" class="hover:text-primary-500 transition-colors">Changelog</a>
          <a href="/blog.html" class="hover:text-primary-500 transition-colors">Blog</a>
          <a href="/terms.html" class="hover:text-primary-500 transition-colors">Terms of Service</a>
        </div>

        <p class="text-sm text-slate-500 dark:text-slate-400">
          &copy; 2026 MailVault. All rights reserved.
        </p>
      </div>
    </div>
  </footer>

  <script>
    // Theme toggle
    const themeToggle = document.getElementById('theme-toggle');
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');

    function updateThemeIcons() {
      const isDark = document.documentElement.classList.contains('dark');
      sunIcon.classList.toggle('hidden', !isDark);
      moonIcon.classList.toggle('hidden', isDark);
    }

    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    }
    updateThemeIcons();

    themeToggle.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
      updateThemeIcons();
    });

    // Mobile Menu
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIconOpen = document.getElementById('menu-icon-open');
    const menuIconClose = document.getElementById('menu-icon-close');
    mobileMenuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
      menuIconOpen.classList.toggle('hidden');
      menuIconClose.classList.toggle('hidden');
    });
    document.querySelectorAll('#mobile-menu a').forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        menuIconOpen.classList.remove('hidden');
        menuIconClose.classList.add('hidden');
      });
    });
  </script>

</body>
</html>
